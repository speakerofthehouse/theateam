<meta charset="UTF-8">
<title>Shuffle+</title>
<link type="text/css" rel="stylesheet" href="basicstyle.css" />
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<script>
      var currentPlaylist;
      var shuffleType;
      var biasCategory = "artist";
      var categories = [];
      var tracks = [];

      var beginning = "";
      if ("<%= env %>" === "Local") {
        beginning = "http://localhost:5000";
      } else {
        beginning = "shuffleplus.herokuapp.com";
      }
      var renderTracklist = function(caller){
        //Get tracklist id from html button element
        currentPlaylist = caller.getAttribute("id");
        //Call the get-tracks endpoint with the given playlist's id
        $.ajax({
          url: beginning + "/get-tracks/<%= user_id %>/" + currentPlaylist + "/<%= access_token %>",
          context: document.body
        }).done(function(data){
          //Append the returned html to the tracklist div
          //$("#tl-div").html(data);
          console.log(tracks);
          getCategories();
          listCategories();
          //Make a Spotify play button widget and prepend it to the tracklist div
          var src = "https://embed.spotify.com/?uri=spotify:user:" + <%= user_id %> + ":playlist:" + currentPlaylist + "&theme=white&view=coverart"
          var player = document.createElement("iframe");
          player.setAttribute("src", src);
          player.setAttribute("frameborder", "0");
          player.setAttribute("allowtransparency", "true");
          $("#tl-div").prepend(player);
          var randomShuffleBtn = document.createElement("button");
          randomShuffleBtn.innerHTML = "Random Shuffle";
          randomShuffleBtn.setAttribute("name", "random");
          randomShuffleBtn.setAttribute("onClick", "shufflePlaylist(this)");
          $("#tl-div").prepend(randomShuffleBtn);
          var spreadShuffleBtn = document.createElement("button");
          spreadShuffleBtn.innerHTML = "Spread Shuffle";
          spreadShuffleBtn.setAttribute("name", "spread");
          spreadShuffleBtn.setAttribute("onClick", "shufflePlaylist(this)");
          $("#tl-div").prepend(spreadShuffleBtn);
        });
      };

      var shufflePlaylist = function(caller){
        $("#tl-div").html("<p>Shuffling...</p>");
        shuffleType = caller.getAttribute("name");
        $.ajax({
          url: beginning + "/shuffle/" + shuffleType + "/<%= user_id %>/" + currentPlaylist +  "/<%= access_token %>",
        }).done(function(data){
          if (data === "Shuffle Success"){
            console.log("Shuffle Success");
            document.getElementsByName(currentPlaylist)[0].click();
          }
          else {
            console.log("Shuffle Error");
          }
        });
      };

      var getCategories = function(){
        $.ajax({
          url: beginning + "/get-categories/<%= user_id %>/" + currentPlaylist + "/" + biasCategory +  "/<%= access_token %>",
          context: document.body
        }).done(function(data){
          categories = data;
        });
      }

</script>
